
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Tester</title>
  <style>
    body { font-family: Arial; padding: 20px; margin: 0; }
    nav { display: flex; gap: 10px; flex-wrap: wrap; background: #eee; padding: 10px; }
    nav button { padding: 10px; border: none; cursor: pointer; background: #2196F3; color: white; border-radius: 4px; }
    .card { display: none; margin-top: 20px; }
    .card.active { display: block; }
    input, textarea, select, button { margin: 5px 0; display: block; width: 100%; padding: 8px; }
    ul { list-style: none; padding-left: 0; }
    li { background: #f9f9f9; margin-bottom: 10px; padding: 10px; border-radius: 4px; }
  </style>
</head>
<body>
  <nav>
    <button onclick="showTab('add')">‚ûï Add MCQ</button>
    <button onclick="showTab('test')">üß™ Test</button>
    <button onclick="showTab('score')">üìä Score</button>
    <button onclick="showTab('manage')">üìã Manage MCQs</button>
    <button onclick="showTab('settings')">‚öôÔ∏è Settings</button>
    <button onclick="showTab('import')">üìÑ Import PDF</button>
  </nav>

  <section id="add" class="card active">
    <h3>Add MCQ</h3>
    <input id="q" placeholder="Question">
    <input id="a" placeholder="Option A">
    <input id="b" placeholder="Option B">
    <input id="c" placeholder="Option C">
    <input id="d" placeholder="Option D">
    <input id="correct" placeholder="Correct Answer (A, B, C, D)">
    <input id="topic" placeholder="Topic">
    <button onclick="saveMCQ()">Save</button>
  </section>

  <section id="test" class="card"></section>
  <section id="score" class="card"></section>
  <section id="manage" class="card"></section>
  <section id="settings" class="card">
    <h3>‚öôÔ∏è Settings</h3>
    <label>Test Timer (minutes):</label>
    <input id="timerInput" type="number" min="0" value="0">
    <label>Number of Questions per Test:</label>
    <input id="questionCountInput" type="number" min="1" value="5">
    <button onclick="saveSettings()">Save Settings</button>
  </section>

  <section id="import" class="card">
    <h3>üìÑ Import MCQs from PDF Text (with Answers)</h3>
    <textarea id="pdfText" rows="14" placeholder="Paste raw PDF text here..."></textarea>
    <button onclick="parseMCQsFromPDF()">Parse & Save</button>
    <ul id="parsedPreview"></ul>
  </section>

  <script>
    let mcqs = JSON.parse(localStorage.getItem("mcqs") || "[]");
    let scores = JSON.parse(localStorage.getItem("scores") || "[]");
    let settings = JSON.parse(localStorage.getItem("settings") || '{"timer":0,"count":5}');
    document.getElementById("timerInput").value = settings.timer;
    document.getElementById("questionCountInput").value = settings.count;

    function showTab(id) {
      document.querySelectorAll(".card").forEach(c => c.classList.remove("active"));
      document.getElementById(id).classList.add("active");
      if (id === "manage") renderMCQs();
      if (id === "score") renderScores();
      if (id === "test") setupTest();
    }

    function saveMCQ() {
      const q = document.getElementById("q").value;
      const a = document.getElementById("a").value;
      const b = document.getElementById("b").value;
      const c = document.getElementById("c").value;
      const d = document.getElementById("d").value;
      const correct = document.getElementById("correct").value.toUpperCase();
      const topic = document.getElementById("topic").value || "General";
      if (q && a && b && c && d && ["A","B","C","D"].includes(correct)) {
        mcqs.push({ q, a, b, c, d, correct, topic });
        localStorage.setItem("mcqs", JSON.stringify(mcqs));
        alert("Saved!");
      }
    }

    function renderMCQs() {
      const ul = document.getElementById("manage");
      ul.innerHTML = '<h3>Manage MCQs</h3><ul>' + mcqs.map((m, i) => `
        <li>
          <b>${m.q}</b><br>A: ${m.a}<br>B: ${m.b}<br>C: ${m.c}<br>D: ${m.d}<br>
          Correct: ${m.correct} | Topic: ${m.topic}<br>
          <button onclick="editMCQ(${i})">‚úèÔ∏è Edit</button>
          <button onclick="deleteMCQ(${i})">‚ùå Delete</button>
        </li>`).join("") + '</ul><button onclick="deleteAllMCQs()" style="background:#d32f2f;color:white;">üóëÔ∏è Delete All MCQs</button>';
    }

    function editMCQ(i) {
      const m = mcqs[i];
      document.getElementById("q").value = m.q;
      document.getElementById("a").value = m.a;
      document.getElementById("b").value = m.b;
      document.getElementById("c").value = m.c;
      document.getElementById("d").value = m.d;
      document.getElementById("correct").value = m.correct;
      document.getElementById("topic").value = m.topic;
      mcqs.splice(i, 1);
      localStorage.setItem("mcqs", JSON.stringify(mcqs));
      showTab("add");
    }

    function deleteMCQ(i) {
      mcqs.splice(i, 1);
      localStorage.setItem("mcqs", JSON.stringify(mcqs));
      renderMCQs();
    }

    function deleteAllMCQs() {
      if (confirm("Are you sure you want to delete ALL MCQs?")) {
        mcqs = [];
        localStorage.setItem("mcqs", "[]");
        renderMCQs();
      }
    }

    function saveSettings() {
      settings.timer = parseInt(document.getElementById("timerInput").value || 0);
      settings.count = parseInt(document.getElementById("questionCountInput").value || 5);
      localStorage.setItem("settings", JSON.stringify(settings));
      alert("Settings saved");
    }

    function setupTest() {
      const count = Math.min(settings.count, mcqs.length);
      const topics = [...new Set(mcqs.map(m => m.topic))];
      const selectedTopic = prompt("Enter topic to test (or leave blank for All):");
      const filtered = selectedTopic ? mcqs.filter(m => m.topic === selectedTopic) : mcqs.slice();
      const shuffled = confirm("Shuffle questions?") ? filtered.sort(() => Math.random() - 0.5) : filtered;
      const selected = shuffled.slice(0, count);
      let score = 0, incorrect = [];
      let i = 0;

      const div = document.getElementById("test");
      div.innerHTML = `<h3>Test (${count} Qs)</h3><div id="quiz"></div><div id="result"></div>`;
      ask();

      function ask() {
        if (i >= selected.length) {
          div.querySelector("#result").innerHTML = `‚úÖ Score: ${score}/${selected.length} (${Math.round(score/selected.length*100)}%)<br>
          <button onclick="retestIncorrect(${JSON.stringify(incorrect).replace(/"/g, '&quot;')})">Retest Incorrect</button>`;
          scores.push({ correct: score, total: selected.length, date: new Date().toLocaleString() });
          localStorage.setItem("scores", JSON.stringify(scores));
          return;
        }
        const m = selected[i];
        div.querySelector("#quiz").innerHTML = `
          <p><b>Q${i+1}: ${m.q}</b></p>
          <button onclick="check('A')">A. ${m.a}</button>
          <button onclick="check('B')">B. ${m.b}</button>
          <button onclick="check('C')">C. ${m.c}</button>
          <button onclick="check('D')">D. ${m.d}</button>`;
        function check(ans) {
          if (ans === m.correct) score++;
          else incorrect.push(m);
          i++;
          ask();
        }
      }
    }

    function retestIncorrect(json) {
      mcqs = JSON.parse(localStorage.getItem("mcqs") || "[]");
      const retest = JSON.parse(json);
      localStorage.setItem("mcqs", JSON.stringify(retest));
      showTab("test");
    }

    function renderScores() {
      const div = document.getElementById("score");
      div.innerHTML = "<h3>Score History</h3><ul>" + scores.map(s => `
        <li>${s.date}: ${s.correct}/${s.total} (${Math.round(s.correct/s.total*100)}%)</li>
      `).join("") + "</ul>";
    }

    function parseMCQsFromPDF() {
      const text = document.getElementById("pdfText").value;
      const lines = text.split(/\n+/);
      const mcqsParsed = [], answers = {};

      lines.forEach(line => {
        const match = line.match(/^(\d{1,3})\.\s*([a-dA-D])\./);
        if (match) answers[match[1]] = match[2].toUpperCase();
      });

      for (let i = 0; i < lines.length; i++) {
        if (/^\d+\./.test(lines[i])) {
          const qNum = lines[i].match(/^(\d+)/)?.[1];
          const question = lines[i].replace(/^\d+\.\s*/, "");
          const a = lines[i+1]?.replace(/^[aA]\./, "").trim();
          const b = lines[i+2]?.replace(/^[bB]\./, "").trim();
          const c = lines[i+3]?.replace(/^[cC]\./, "").trim();
          const d = lines[i+4]?.replace(/^[dD]\./, "").trim();
          const correct = answers[qNum] || "";
          if (a && b && c && d) {
            mcqsParsed.push({ q: question, a, b, c, d, correct, topic: "PDF Imported" });
            i += 4;
          }
        }
      }

      if (!mcqsParsed.length) return alert("No questions detected.");
      mcqs = mcqs.concat(mcqsParsed);
      localStorage.setItem("mcqs", JSON.stringify(mcqs));
      document.getElementById("parsedPreview").innerHTML = mcqsParsed.map(m => 
        `<li><b>${m.q}</b><br>A: ${m.a}<br>B: ${m.b}<br>C: ${m.c}<br>D: ${m.d}<br><b>Correct:</b> ${m.correct}</li>`
      ).join("");
      alert(mcqsParsed.length + " MCQs imported.");
    }
  </script>
</body>
</html>
